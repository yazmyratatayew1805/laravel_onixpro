(()=>{"use strict";var t="undefined"!=typeof window?window:null,e=null===t,n=e?void 0:t.document,r="addEventListener",i="removeEventListener",o="getBoundingClientRect",s="_a",c="_b",a="_c",l="horizontal",u=function(){return!1},d=e?"calc":["","-webkit-","-moz-","-o-"].filter((function(t){var e=n.createElement("div");return e.style.cssText="width:"+t+"calc(9px)",!!e.style.length})).shift()+"calc",p=function(t){return"string"==typeof t||t instanceof String},f=function(t){if(p(t)){var e=n.querySelector(t);if(!e)throw new Error("Selector "+t+" did not match a DOM element");return e}return t},h=function(t,e,n){var r=t[e];return void 0!==r?r:n},m=function(t,e,n,r){if(e){if("end"===r)return 0;if("center"===r)return t/2}else if(n){if("start"===r)return 0;if("center"===r)return t/2}return t},v=function(t,e){var r=n.createElement("div");return r.className="gutter gutter-"+e,r},y=function(t,e,n){var r={};return p(e)?r[t]=e:r[t]=d+"("+e+"% - "+n+"px)",r},g=function(t,e){var n;return(n={})[t]=e+"px",n};const b=function(d,p){if(void 0===p&&(p={}),e)return{};var b,S,C,O,w,E,P=d;Array.from&&(P=Array.from(P));var z=f(P[0]).parentNode,j=getComputedStyle?getComputedStyle(z):null,T=j?j.flexDirection:null,k=h(p,"sizes")||P.map((function(){return 100/P.length})),x=h(p,"minSize",100),D=Array.isArray(x)?x:P.map((function(){return x})),A=h(p,"maxSize",1/0),R=Array.isArray(A)?A:P.map((function(){return A})),B=h(p,"expandToMin",!1),M=h(p,"gutterSize",10),H=h(p,"gutterAlign","center"),L=h(p,"snapOffset",30),U=Array.isArray(L)?L:P.map((function(){return L})),W=h(p,"dragInterval",1),I=h(p,"direction",l),N=h(p,"cursor",I===l?"col-resize":"row-resize"),V=h(p,"gutter",v),$=h(p,"elementStyle",y),F=h(p,"gutterStyle",g);function _(t,e,n,r){var i=$(b,e,n,r);Object.keys(i).forEach((function(e){t.style[e]=i[e]}))}function J(){return E.map((function(t){return t.size}))}function q(t){return"touches"in t?t.touches[0][S]:t[S]}function X(t){var e=E[this.a],n=E[this.b],r=e.size+n.size;e.size=t/this.size*r,n.size=r-t/this.size*r,_(e.element,e.size,this[c],e.i),_(n.element,n.size,this[a],n.i)}function Y(t){var e,n=E[this.a],r=E[this.b];this.dragging&&(e=q(t)-this.start+(this[c]-this.dragOffset),W>1&&(e=Math.round(e/W)*W),e<=n.minSize+n.snapOffset+this[c]?e=n.minSize+this[c]:e>=this.size-(r.minSize+r.snapOffset+this[a])&&(e=this.size-(r.minSize+this[a])),e>=n.maxSize-n.snapOffset+this[c]?e=n.maxSize+this[c]:e<=this.size-(r.maxSize-r.snapOffset+this[a])&&(e=this.size-(r.maxSize+this[a])),X.call(this,e),h(p,"onDrag",u)(J()))}function G(){var t=E[this.a].element,e=E[this.b].element,n=t[o](),r=e[o]();this.size=n[b]+r[b]+this[c]+this[a],this.start=n[C],this.end=n[O]}function K(t){var e=function(t){if(!getComputedStyle)return null;var e=getComputedStyle(t);if(!e)return null;var n=t[w];return 0===n?null:n-=I===l?parseFloat(e.paddingLeft)+parseFloat(e.paddingRight):parseFloat(e.paddingTop)+parseFloat(e.paddingBottom)}(z);if(null===e)return t;if(D.reduce((function(t,e){return t+e}),0)>e)return t;var n=0,r=[],i=t.map((function(i,o){var s=e*i/100,c=m(M,0===o,o===t.length-1,H),a=D[o]+c;return s<a?(n+=a-s,r.push(0),a):(r.push(s-a),s)}));return 0===n?t:i.map((function(t,i){var o=t;if(n>0&&r[i]-n>0){var s=Math.min(n,r[i]-n);n-=s,o=t-s}return o/e*100}))}function Q(){var e=this,r=E[e.a].element,o=E[e.b].element;e.dragging&&h(p,"onDragEnd",u)(J()),e.dragging=!1,t[i]("mouseup",e.stop),t[i]("touchend",e.stop),t[i]("touchcancel",e.stop),t[i]("mousemove",e.move),t[i]("touchmove",e.move),e.stop=null,e.move=null,r[i]("selectstart",u),r[i]("dragstart",u),o[i]("selectstart",u),o[i]("dragstart",u),r.style.userSelect="",r.style.webkitUserSelect="",r.style.MozUserSelect="",r.style.pointerEvents="",o.style.userSelect="",o.style.webkitUserSelect="",o.style.MozUserSelect="",o.style.pointerEvents="",e.gutter.style.cursor="",e.parent.style.cursor="",n.body.style.cursor=""}function Z(e){if(!("button"in e)||0===e.button){var i=this,o=E[i.a].element,s=E[i.b].element;i.dragging||h(p,"onDragStart",u)(J()),e.preventDefault(),i.dragging=!0,i.move=Y.bind(i),i.stop=Q.bind(i),t[r]("mouseup",i.stop),t[r]("touchend",i.stop),t[r]("touchcancel",i.stop),t[r]("mousemove",i.move),t[r]("touchmove",i.move),o[r]("selectstart",u),o[r]("dragstart",u),s[r]("selectstart",u),s[r]("dragstart",u),o.style.userSelect="none",o.style.webkitUserSelect="none",o.style.MozUserSelect="none",o.style.pointerEvents="none",s.style.userSelect="none",s.style.webkitUserSelect="none",s.style.MozUserSelect="none",s.style.pointerEvents="none",i.gutter.style.cursor=N,i.parent.style.cursor=N,n.body.style.cursor=N,G.call(i),i.dragOffset=q(e)-i.end}}I===l?(b="width",S="clientX",C="left",O="right",w="clientWidth"):"vertical"===I&&(b="height",S="clientY",C="top",O="bottom",w="clientHeight"),k=K(k);var tt=[];function et(t){var e=t.i===tt.length,n=e?tt[t.i-1]:tt[t.i];G.call(n);var r=e?n.size-t.minSize-n[a]:t.minSize+n[c];X.call(n,r)}return(E=P.map((function(t,e){var n,i={element:f(t),size:k[e],minSize:D[e],maxSize:R[e],snapOffset:U[e],i:e};if(e>0&&((n={a:e-1,b:e,dragging:!1,direction:I,parent:z})[c]=m(M,e-1==0,!1,H),n[a]=m(M,!1,e===P.length-1,H),"row-reverse"===T||"column-reverse"===T)){var o=n.a;n.a=n.b,n.b=o}if(e>0){var l=V(e,I,i.element);!function(t,e,n){var r=F(b,e,n);Object.keys(r).forEach((function(e){t.style[e]=r[e]}))}(l,M,e),n[s]=Z.bind(n),l[r]("mousedown",n[s]),l[r]("touchstart",n[s]),z.insertBefore(l,i.element),n.gutter=l}return _(i.element,i.size,m(M,0===e,e===P.length-1,H),e),e>0&&tt.push(n),i}))).forEach((function(t){var e=t.element[o]()[b];e<t.minSize&&(B?et(t):t.minSize=e)})),{setSizes:function(t){var e=K(t);e.forEach((function(t,n){if(n>0){var r=tt[n-1],i=E[r.a],o=E[r.b];i.size=e[n-1],o.size=t,_(i.element,i.size,r[c],i.i),_(o.element,o.size,r[a],o.i)}}))},getSizes:J,collapse:function(t){et(E[t])},destroy:function(t,e){tt.forEach((function(n){if(!0!==e?n.parent.removeChild(n.gutter):(n.gutter[i]("mousedown",n[s]),n.gutter[i]("touchstart",n[s])),!0!==t){var r=$(b,n.a.size,n[c]);Object.keys(r).forEach((function(t){E[n.a].element.style[t]="",E[n.b].element.style[t]=""}))}}))},parent:z,pairs:tt}};function S(t){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},S(t)}function C(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function O(t,e,n){return(e=E(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function w(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,E(r.key),r)}}function E(t){var e=function(t,e){if("object"!==S(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!==S(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===S(e)?e:String(e)}var P=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.editor=e,this.$=e.$,this.pfx=e.getConfig("stylePrefix"),this.opts=n,this.canvas=this.findWithinEditor(".".concat(this.pfx,"cv-canvas")),this.panelViews=n.appendTo?this.$(n.appendTo):this.findWithinEditor(".".concat(this.pfx,"pn-").concat(n.panelId)),this.isShowing=!0}var e,n,r;return e=t,n=[{key:"findPanel",value:function(){var t=this.editor.Panels,e=this.opts.panelId;return t.getPanel(e)||t.addPanel({id:e})}},{key:"findWithinEditor",value:function(t){return this.$(t,this.editor.getEl())}},{key:"buildCodeEditor",value:function(t){var e=this.editor,n=this.opts;return e.CodeManager.createViewer(function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?C(Object(n),!0).forEach((function(e){O(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({codeName:"html"===t?"htmlmixed":"css",theme:"hopscotch",readOnly:0,autoBeautify:1,autoCloseTags:1,autoCloseBrackets:1,styleActiveLine:1,smartIndent:1},n.codeViewOptions))}},{key:"buildSection",value:function(t,e){var n=this.$,r=this.pfx,i=this.opts,o=n("<section></section>"),s="html"===t?i.htmlBtnText:i.cssBtnText,c=i.cleanCssBtn&&"css"===t?'<button class="cp-delete-'.concat(t," ").concat(r,'btn-prim">').concat(i.cleanCssBtnText,"</button>"):"";o.append(n('\n            <div class="codepanel-separator">\n                <div class="codepanel-label">'.concat(t,'</div>\n                <div class="cp-btn-container">\n                    ').concat(c,'\n                    <button class="cp-apply-').concat(t," ").concat(r,'btn-prim">').concat(s,"</button>\n                </div>\n            </div>")));var a=e.getElement();return a.style.height="calc(100% - 30px)",o.append(a),this.codePanel.append(o),o.get(0)}},{key:"buildCodePanel",value:function(){var t=this,e=this.$,n=this.editor,r=this.opts.panelId?this.findPanel():0;this.codePanel=e("<div></div>"),this.codePanel.addClass("code-panel"),this.htmlCodeEditor=this.buildCodeEditor("html"),this.cssCodeEditor=this.buildCodeEditor("css");var i=[this.buildSection("html",this.htmlCodeEditor),this.buildSection("css",this.cssCodeEditor)];r&&!this.opts.appendTo&&r.set("appendContent",this.codePanel).trigger("change:appendContent"),this.opts.appendTo&&e(this.opts.appendTo).append(this.codePanel),this.updateEditorContents(),this.codePanel.find(".cp-apply-html").on("click",this.updateHtml.bind(this)),this.codePanel.find(".cp-apply-css").on("click",this.updateCss.bind(this)),this.opts.cleanCssBtn&&this.codePanel.find(".cp-delete-css").on("click",this.deleteSelectedCss.bind(this)),b(i,{direction:"vertical",sizes:[50,50],minSize:100,gutterSize:1,onDragEnd:this.refreshEditors.bind(this)}),n.on("component:update",(function(e){return t.updateEditorContents()}))}},{key:"showCodePanel",value:function(){this.isShowing=!0,this.updateEditorContents(),this.codePanel.css("display","block"),setTimeout(this.refreshEditors.bind(this),320),this.opts.preserveWidth||(this.panelViews.css("width",this.opts.openState.pn),this.canvas.css("width",this.opts.openState.cv))}},{key:"hideCodePanel",value:function(){this.codePanel&&this.codePanel.css("display","none"),this.isShowing=!1,this.opts.preserveWidth||(this.panelViews.css("width",this.opts.closedState.pn),this.canvas.css("width",this.opts.closedState.cv))}},{key:"refreshEditors",value:function(){this.htmlCodeEditor.refresh(),this.cssCodeEditor.refresh()}},{key:"updateHtml",value:function(t){null==t||t.preventDefault();var e=this.editor,n=this.component,r=this.htmlCodeEditor.getContent().trim();if(r&&r!==this.previousHtmlCode){this.previousHtmlCode=r;var i="";this.cssCodeEditor.getContent().split(/(?<=}\n)/g).forEach((function(t){/^#/.test(t)&&(i+=t)})),r+="<style>".concat(i,"</style>"),e.select(n.replaceWith(r))}}},{key:"updateCss",value:function(t){null==t||t.preventDefault();var e=this.cssCodeEditor.getContent().trim();e&&e!==this.previousCssCode&&(this.parseRemove(e),this.previousCssCode=e,this.editor.Components.addComponent("<style>".concat(e,"</style>")))}},{key:"deleteSelectedCss",value:function(t){var e=this;null==t||t.preventDefault(),this.cssCodeEditor.editor.getSelections().forEach((function(t){return e.parseRemove(t)})),this.cssCodeEditor.editor.deleteH()}},{key:"parseRemove",value:function(t){var e=this,n=this.editor,r=n.CssComposer,i=r.getAll();n.Parser.parseCss(t).forEach((function(t){var n={singleAtRule:t.singleAtRule,atRuleType:t.atRuleType,mediaText:t.mediaText,state:t.state};t.selectors.length&&t.selectors.forEach((function(t){e.removeSelector(t,i,r,n)})),t.selectorsAdd&&t.selectorsAdd.split(", ").forEach((function(t){e.removeSelector(t,i,r,n)}))}))}},{key:"removeSelector",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=r.singleAtRule,o=r.atRuleType,s=r.mediaText,c=r.state,a=e.filter((function(e){return o&&s?function(t){return t.get("atRuleType")==o&&t.get("mediaText")==s}:o&&i?function(t){return t.get("atRuleType")==o&&t.get("singleAtRule")==i}:c?e==n.getRule("".concat(t,":").concat(c)):e==n.getRule(t)}));e.remove(a)}},{key:"updateEditorContents",value:function(){this.isShowing&&(this.component=this.editor.getSelected(),this.component&&(this.htmlCodeEditor.setContent(this.getComponentHtml(this.component)),this.cssCodeEditor.setContent(this.editor.CodeManager.getCode(this.component,"css",{cssc:this.editor.CssComposer}))))}},{key:"getComponentHtml",value:function(t){var e=this.pfx,n=this.opts,r="",i=t.getEl();!n.clearData&&i.classList.remove("".concat(e,"selected"));var o=n.clearData?t.toHTML():"wrapper"===i.id?i.innerHTML:i.outerHTML;!n.clearData&&i.classList.add("".concat(e,"selected")),r+=o;var s=n.editJs?t.getScriptString():"";return r+=s?"<script>".concat(s,"<\/script>"):""}}],n&&w(e.prototype,n),r&&w(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function z(t){return z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},z(t)}function j(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function T(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?j(Object(n),!0).forEach((function(e){k(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function k(t,e,n){return(e=function(t){var e=function(t,e){if("object"!==z(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!==z(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===z(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const x=function(t,e){var n=t.Commands,r=null;n.add("open-code",{run:function(t){!r&&(r=new P(t,e))&&r.buildCodePanel(),r.showCodePanel()},stop:function(t){r&&r.hideCodePanel()}}),n.add("code-editor-object",(function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new P(t,T(T({},r),e))})),n.add("code-editor-constructor",(function(){return P}))};function D(t){return D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},D(t)}function A(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function R(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?A(Object(n),!0).forEach((function(e){B(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function B(t,e,n){return(e=function(t){var e=function(t,e){if("object"!==D(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!==D(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===D(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}window.grapesjs.plugins.add("code-editor",(function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=R(R({},{panelId:"views-container",appendTo:"",openState:{cv:"65%",pn:"35%"},closedState:{cv:"85%",pn:"15%"},editJs:!1,clearData:!1,codeViewOptions:{},cleanCssBtn:!0,htmlBtnText:"Apply",cssBtnText:"Apply",cleanCssBtnText:"Delete"}),e);x(t,n)}))})();
//# sourceMappingURL=grapeCodeEditor.js.map